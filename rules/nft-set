table filter {
    set allowed {
        type ipv4_addr;
        elements = {
            192.170.0.1,
            192.170.0.2,
            192.170.0.3,
            192.170.0.4,
            192.170.0.5,
            192.170.0.6,
            192.170.0.7,
            192.170.0.8,
            192.170.0.9,
            192.170.0.10,
            192.170.0.11,
            192.170.0.12,
            192.170.0.13,
            192.170.0.14,
            192.170.0.15,
            192.170.0.16,
            192.170.0.17,
            192.170.0.18,
            192.170.0.19,
            192.170.0.20,
            192.170.0.21,
            192.170.0.22,
            192.170.0.23,
            192.170.0.24,
            192.170.0.25,
            192.170.0.26,
            192.170.0.27,
            192.170.0.28,
            192.170.0.29,
            192.170.0.30,
            192.170.0.31,
            192.170.0.32,
            192.170.0.33,
            192.170.0.34,
            192.170.0.35,
            192.170.0.36,
            192.170.0.37,
            192.170.0.38,
            192.170.0.39,
            192.170.0.40,
            192.170.0.41,
            192.170.0.42,
            192.170.0.43,
            192.170.0.44,
            192.170.0.45,
            192.170.0.46,
            192.170.0.47,
            192.170.0.48,
            192.170.0.49,
            192.170.0.50,
            192.170.0.51,
            192.170.0.52,
            192.170.0.53,
            192.170.0.54,
            192.170.0.55,
            192.170.0.56,
            192.170.0.57,
            192.170.0.58,
            192.170.0.59,
            192.170.0.60,
            192.170.0.61,
            192.170.0.62,
            192.170.0.63,
            192.170.0.64,
            192.170.0.65,
            192.170.0.66,
            192.170.0.67,
            192.170.0.68,
            192.170.0.69,
            192.170.0.70,
            192.170.0.71,
            192.170.0.72,
            192.170.0.73,
            192.170.0.74,
            192.170.0.75,
            192.170.0.76,
            192.170.0.77,
            192.170.0.78,
            192.170.0.79,
            192.170.0.80,
            192.170.0.81,
            192.170.0.82,
            192.170.0.83,
            192.170.0.84,
            192.170.0.85,
            192.170.0.86,
            192.170.0.87,
            192.170.0.88,
            192.170.0.89,
            192.170.0.90,
            192.170.0.91,
            192.170.0.92,
            192.170.0.93,
            192.170.0.94,
            192.170.0.95,
            192.170.0.96,
            192.170.0.97,
            192.170.0.98,
            192.170.0.99,
            192.170.0.100,
            192.170.0.101,
            192.170.0.102,
            192.170.0.103,
            192.170.0.104,
            192.170.0.105,
            192.170.0.106,
            192.170.0.107,
            192.170.0.108,
            192.170.0.109,
            192.170.0.110,
            192.170.0.111,
            192.170.0.112,
            192.170.0.113,
            192.170.0.114,
            192.170.0.115,
            192.170.0.116,
            192.170.0.117,
            192.170.0.118,
            192.170.0.119,
            192.170.0.120,
            192.170.0.121,
            192.170.0.122,
            192.170.0.123,
            192.170.0.124,
            192.170.0.125,
            192.170.0.126,
            192.170.0.127,
            192.170.0.128,
            192.170.0.129,
            192.170.0.130,
            192.170.0.131,
            192.170.0.132,
            192.170.0.133,
            192.170.0.134,
            192.170.0.135,
            192.170.0.136,
            192.170.0.137,
            192.170.0.138,
            192.170.0.139,
            192.170.0.140,
            192.170.0.141,
            192.170.0.142,
            192.170.0.143,
            192.170.0.144,
            192.170.0.145,
            192.170.0.146,
            192.170.0.147,
            192.170.0.148,
            192.170.0.149,
            192.170.0.150,
            192.170.0.151,
            192.170.0.152,
            192.170.0.153,
            192.170.0.154,
            192.170.0.155,
            192.170.0.156,
            192.170.0.157,
            192.170.0.158,
            192.170.0.159,
            192.170.0.160,
            192.170.0.161,
            192.170.0.162,
            192.170.0.163,
            192.170.0.164,
            192.170.0.165,
            192.170.0.166,
            192.170.0.167,
            192.170.0.168,
            192.170.0.169,
            192.170.0.170,
            192.170.0.171,
            192.170.0.172,
            192.170.0.173,
            192.170.0.174,
            192.170.0.175,
            192.170.0.176,
            192.170.0.177,
            192.170.0.178,
            192.170.0.179,
            192.170.0.180,
            192.170.0.181,
            192.170.0.182,
            192.170.0.183,
            192.170.0.184,
            192.170.0.185,
            192.170.0.186,
            192.170.0.187,
            192.170.0.188,
            192.170.0.189,
            192.170.0.190,
            192.170.0.191,
            192.170.0.192,
            192.170.0.193,
            192.170.0.194,
            192.170.0.195,
            192.170.0.196,
            192.170.0.197,
            192.170.0.198,
            192.170.0.199,
            192.170.0.200,
            192.170.0.201,
            192.170.0.202,
            192.170.0.203,
            192.170.0.204,
            192.170.0.205,
            192.170.0.206,
            192.170.0.207,
            192.170.0.208,
            192.170.0.209,
            192.170.0.210,
            192.170.0.211,
            192.170.0.212,
            192.170.0.213,
            192.170.0.214,
            192.170.0.215,
            192.170.0.216,
            192.170.0.217,
            192.170.0.218,
            192.170.0.219,
            192.170.0.220,
            192.170.0.221,
            192.170.0.222,
            192.170.0.223,
            192.170.0.224,
            192.170.0.225,
            192.170.0.226,
            192.170.0.227,
            192.170.0.228,
            192.170.0.229,
            192.170.0.230,
            192.170.0.231,
            192.170.0.232,
            192.170.0.233,
            192.170.0.234,
            192.170.0.235,
            192.170.0.236,
            192.170.0.237,
            192.170.0.238,
            192.170.0.239,
            192.170.0.240,
            192.170.0.241,
            192.170.0.242,
            192.170.0.243,
            192.170.0.244,
            192.170.0.245,
            192.170.0.246,
            192.170.0.247,
            192.170.0.248,
            192.170.0.249,
            192.170.0.250,
            192.170.0.251,
            192.170.0.252,
            192.170.0.253,
            192.170.0.254,
            192.170.1.1,
            192.170.1.2,
            192.170.1.3,
            192.170.1.4,
            192.170.1.5,
            192.170.1.6,
            192.170.1.7,
            192.170.1.8,
            192.170.1.9,
            192.170.1.10,
            192.170.1.11,
            192.170.1.12,
            192.170.1.13,
            192.170.1.14,
            192.170.1.15,
            192.170.1.16,
            192.170.1.17,
            192.170.1.18,
            192.170.1.19,
            192.170.1.20,
            192.170.1.21,
            192.170.1.22,
            192.170.1.23,
            192.170.1.24,
            192.170.1.25,
            192.170.1.26,
            192.170.1.27,
            192.170.1.28,
            192.170.1.29,
            192.170.1.30,
            192.170.1.31,
            192.170.1.32,
            192.170.1.33,
            192.170.1.34,
            192.170.1.35,
            192.170.1.36,
            192.170.1.37,
            192.170.1.38,
            192.170.1.39,
            192.170.1.40,
            192.170.1.41,
            192.170.1.42,
            192.170.1.43,
            192.170.1.44,
            192.170.1.45,
            192.170.1.46,
            192.170.1.47,
            192.170.1.48,
            192.170.1.49,
            192.170.1.50,
            192.170.1.51,
            192.170.1.52,
            192.170.1.53,
            192.170.1.54,
            192.170.1.55,
            192.170.1.56,
            192.170.1.57,
            192.170.1.58,
            192.170.1.59,
            192.170.1.60,
            192.170.1.61,
            192.170.1.62,
            192.170.1.63,
            192.170.1.64,
            192.170.1.65,
            192.170.1.66,
            192.170.1.67,
            192.170.1.68,
            192.170.1.69,
            192.170.1.70,
            192.170.1.71,
            192.170.1.72,
            192.170.1.73,
            192.170.1.74,
            192.170.1.75,
            192.170.1.76,
            192.170.1.77,
            192.170.1.78,
            192.170.1.79,
            192.170.1.80,
            192.170.1.81,
            192.170.1.82,
            192.170.1.83,
            192.170.1.84,
            192.170.1.85,
            192.170.1.86,
            192.170.1.87,
            192.170.1.88,
            192.170.1.89,
            192.170.1.90,
            192.170.1.91,
            192.170.1.92,
            192.170.1.93,
            192.170.1.94,
            192.170.1.95,
            192.170.1.96,
            192.170.1.97,
            192.170.1.98,
            192.170.1.99,
            192.170.1.100,
            192.170.1.101,
            192.170.1.102,
            192.170.1.103,
            192.170.1.104,
            192.170.1.105,
            192.170.1.106,
            192.170.1.107,
            192.170.1.108,
            192.170.1.109,
            192.170.1.110,
            192.170.1.111,
            192.170.1.112,
            192.170.1.113,
            192.170.1.114,
            192.170.1.115,
            192.170.1.116,
            192.170.1.117,
            192.170.1.118,
            192.170.1.119,
            192.170.1.120,
            192.170.1.121,
            192.170.1.122,
            192.170.1.123,
            192.170.1.124,
            192.170.1.125,
            192.170.1.126,
            192.170.1.127,
            192.170.1.128,
            192.170.1.129,
            192.170.1.130,
            192.170.1.131,
            192.170.1.132,
            192.170.1.133,
            192.170.1.134,
            192.170.1.135,
            192.170.1.136,
            192.170.1.137,
            192.170.1.138,
            192.170.1.139,
            192.170.1.140,
            192.170.1.141,
            192.170.1.142,
            192.170.1.143,
            192.170.1.144,
            192.170.1.145,
            192.170.1.146,
            192.170.1.147,
            192.170.1.148,
            192.170.1.149,
            192.170.1.150,
            192.170.1.151,
            192.170.1.152,
            192.170.1.153,
            192.170.1.154,
            192.170.1.155,
            192.170.1.156,
            192.170.1.157,
            192.170.1.158,
            192.170.1.159,
            192.170.1.160,
            192.170.1.161,
            192.170.1.162,
            192.170.1.163,
            192.170.1.164,
            192.170.1.165,
            192.170.1.166,
            192.170.1.167,
            192.170.1.168,
            192.170.1.169,
            192.170.1.170,
            192.170.1.171,
            192.170.1.172,
            192.170.1.173,
            192.170.1.174,
            192.170.1.175,
            192.170.1.176,
            192.170.1.177,
            192.170.1.178,
            192.170.1.179,
            192.170.1.180,
            192.170.1.181,
            192.170.1.182,
            192.170.1.183,
            192.170.1.184,
            192.170.1.185,
            192.170.1.186,
            192.170.1.187,
            192.170.1.188,
            192.170.1.189,
            192.170.1.190,
            192.170.1.191,
            192.170.1.192,
            192.170.1.193,
            192.170.1.194,
            192.170.1.195,
            192.170.1.196,
            192.170.1.197,
            192.170.1.198,
            192.170.1.199,
            192.170.1.200,
            192.170.1.201,
            192.170.1.202,
            192.170.1.203,
            192.170.1.204,
            192.170.1.205,
            192.170.1.206,
            192.170.1.207,
            192.170.1.208,
            192.170.1.209,
            192.170.1.210,
            192.170.1.211,
            192.170.1.212,
            192.170.1.213,
            192.170.1.214,
            192.170.1.215,
            192.170.1.216,
            192.170.1.217,
            192.170.1.218,
            192.170.1.219,
            192.170.1.220,
            192.170.1.221,
            192.170.1.222,
            192.170.1.223,
            192.170.1.224,
            192.170.1.225,
            192.170.1.226,
            192.170.1.227,
            192.170.1.228,
            192.170.1.229,
            192.170.1.230,
            192.170.1.231,
            192.170.1.232,
            192.170.1.233,
            192.170.1.234,
            192.170.1.235,
            192.170.1.236,
            192.170.1.237,
            192.170.1.238,
            192.170.1.239,
            192.170.1.240,
            192.170.1.241,
            192.170.1.242,
            192.170.1.243,
            192.170.1.244,
            192.170.1.245,
            192.170.1.246,
            192.170.1.247,
            192.170.1.248,
            192.170.1.249,
            192.170.1.250,
            192.170.1.251,
            192.170.1.252,
            192.170.1.253,
            192.170.1.254,
            192.170.2.1,
            192.170.2.2,
            192.170.2.3,
            192.170.2.4,
            192.170.2.5,
            192.170.2.6,
            192.170.2.7,
            192.170.2.8,
            192.170.2.9,
            192.170.2.10,
            192.170.2.11,
            192.170.2.12,
            192.170.2.13,
            192.170.2.14,
            192.170.2.15,
            192.170.2.16,
            192.170.2.17,
            192.170.2.18,
            192.170.2.19,
            192.170.2.20,
            192.170.2.21,
            192.170.2.22,
            192.170.2.23,
            192.170.2.24,
            192.170.2.25,
            192.170.2.26,
            192.170.2.27,
            192.170.2.28,
            192.170.2.29,
            192.170.2.30,
            192.170.2.31,
            192.170.2.32,
            192.170.2.33,
            192.170.2.34,
            192.170.2.35,
            192.170.2.36,
            192.170.2.37,
            192.170.2.38,
            192.170.2.39,
            192.170.2.40,
            192.170.2.41,
            192.170.2.42,
            192.170.2.43,
            192.170.2.44,
            192.170.2.45,
            192.170.2.46,
            192.170.2.47,
            192.170.2.48,
            192.170.2.49,
            192.170.2.50,
            192.170.2.51,
            192.170.2.52,
            192.170.2.53,
            192.170.2.54,
            192.170.2.55,
            192.170.2.56,
            192.170.2.57,
            192.170.2.58,
            192.170.2.59,
            192.170.2.60,
            192.170.2.61,
            192.170.2.62,
            192.170.2.63,
            192.170.2.64,
            192.170.2.65,
            192.170.2.66,
            192.170.2.67,
            192.170.2.68,
            192.170.2.69,
            192.170.2.70,
            192.170.2.71,
            192.170.2.72,
            192.170.2.73,
            192.170.2.74,
            192.170.2.75,
            192.170.2.76,
            192.170.2.77,
            192.170.2.78,
            192.170.2.79,
            192.170.2.80,
            192.170.2.81,
            192.170.2.82,
            192.170.2.83,
            192.170.2.84,
            192.170.2.85,
            192.170.2.86,
            192.170.2.87,
            192.170.2.88,
            192.170.2.89,
            192.170.2.90,
            192.170.2.91,
            192.170.2.92,
            192.170.2.93,
            192.170.2.94,
            192.170.2.95,
            192.170.2.96,
            192.170.2.97,
            192.170.2.98,
            192.170.2.99,
            192.170.2.100,
            192.170.2.101,
            192.170.2.102,
            192.170.2.103,
            192.170.2.104,
            192.170.2.105,
            192.170.2.106,
            192.170.2.107,
            192.170.2.108,
            192.170.2.109,
            192.170.2.110,
            192.170.2.111,
            192.170.2.112,
            192.170.2.113,
            192.170.2.114,
            192.170.2.115,
            192.170.2.116,
            192.170.2.117,
            192.170.2.118,
            192.170.2.119,
            192.170.2.120,
            192.170.2.121,
            192.170.2.122,
            192.170.2.123,
            192.170.2.124,
            192.170.2.125,
            192.170.2.126,
            192.170.2.127,
            192.170.2.128,
            192.170.2.129,
            192.170.2.130,
            192.170.2.131,
            192.170.2.132,
            192.170.2.133,
            192.170.2.134,
            192.170.2.135,
            192.170.2.136,
            192.170.2.137,
            192.170.2.138,
            192.170.2.139,
            192.170.2.140,
            192.170.2.141,
            192.170.2.142,
            192.170.2.143,
            192.170.2.144,
            192.170.2.145,
            192.170.2.146,
            192.170.2.147,
            192.170.2.148,
            192.170.2.149,
            192.170.2.150,
            192.170.2.151,
            192.170.2.152,
            192.170.2.153,
            192.170.2.154,
            192.170.2.155,
            192.170.2.156,
            192.170.2.157,
            192.170.2.158,
            192.170.2.159,
            192.170.2.160,
            192.170.2.161,
            192.170.2.162,
            192.170.2.163,
            192.170.2.164,
            192.170.2.165,
            192.170.2.166,
            192.170.2.167,
            192.170.2.168,
            192.170.2.169,
            192.170.2.170,
            192.170.2.171,
            192.170.2.172,
            192.170.2.173,
            192.170.2.174,
            192.170.2.175,
            192.170.2.176,
            192.170.2.177,
            192.170.2.178,
            192.170.2.179,
            192.170.2.180,
            192.170.2.181,
            192.170.2.182,
            192.170.2.183,
            192.170.2.184,
            192.170.2.185,
            192.170.2.186,
            192.170.2.187,
            192.170.2.188,
            192.170.2.189,
            192.170.2.190,
            192.170.2.191,
            192.170.2.192,
            192.170.2.193,
            192.170.2.194,
            192.170.2.195,
            192.170.2.196,
            192.170.2.197,
            192.170.2.198,
            192.170.2.199,
            192.170.2.200,
            192.170.2.201,
            192.170.2.202,
            192.170.2.203,
            192.170.2.204,
            192.170.2.205,
            192.170.2.206,
            192.170.2.207,
            192.170.2.208,
            192.170.2.209,
            192.170.2.210,
            192.170.2.211,
            192.170.2.212,
            192.170.2.213,
            192.170.2.214,
            192.170.2.215,
            192.170.2.216,
            192.170.2.217,
            192.170.2.218,
            192.170.2.219,
            192.170.2.220,
            192.170.2.221,
            192.170.2.222,
            192.170.2.223,
            192.170.2.224,
            192.170.2.225,
            192.170.2.226,
            192.170.2.227,
            192.170.2.228,
            192.170.2.229,
            192.170.2.230,
            192.170.2.231,
            192.170.2.232,
            192.170.2.233,
            192.170.2.234,
            192.170.2.235,
            192.170.2.236,
            192.170.2.237,
            192.170.2.238,
            192.170.2.239,
            192.170.2.240,
            192.170.2.241,
            192.170.2.242,
            192.170.2.243,
            192.170.2.244,
            192.170.2.245,
            192.170.2.246,
            192.170.2.247,
            192.170.2.248,
            192.170.2.249,
            192.170.2.250,
            192.170.2.251,
            192.170.2.252,
            192.170.2.253,
            192.170.2.254,
            192.170.3.1,
            192.170.3.2,
            192.170.3.3,
            192.170.3.4,
            192.170.3.5,
            192.170.3.6,
            192.170.3.7,
            192.170.3.8,
            192.170.3.9,
            192.170.3.10,
            192.170.3.11,
            192.170.3.12,
            192.170.3.13,
            192.170.3.14,
            192.170.3.15,
            192.170.3.16,
            192.170.3.17,
            192.170.3.18,
            192.170.3.19,
            192.170.3.20,
            192.170.3.21,
            192.170.3.22,
            192.170.3.23,
            192.170.3.24,
            192.170.3.25,
            192.170.3.26,
            192.170.3.27,
            192.170.3.28,
            192.170.3.29,
            192.170.3.30,
            192.170.3.31,
            192.170.3.32,
            192.170.3.33,
            192.170.3.34,
            192.170.3.35,
            192.170.3.36,
            192.170.3.37,
            192.170.3.38,
            192.170.3.39,
            192.170.3.40,
            192.170.3.41,
            192.170.3.42,
            192.170.3.43,
            192.170.3.44,
            192.170.3.45,
            192.170.3.46,
            192.170.3.47,
            192.170.3.48,
            192.170.3.49,
            192.170.3.50,
            192.170.3.51,
            192.170.3.52,
            192.170.3.53,
            192.170.3.54,
            192.170.3.55,
            192.170.3.56,
            192.170.3.57,
            192.170.3.58,
            192.170.3.59,
            192.170.3.60,
            192.170.3.61,
            192.170.3.62,
            192.170.3.63,
            192.170.3.64,
            192.170.3.65,
            192.170.3.66,
            192.170.3.67,
            192.170.3.68,
            192.170.3.69,
            192.170.3.70,
            192.170.3.71,
            192.170.3.72,
            192.170.3.73,
            192.170.3.74,
            192.170.3.75,
            192.170.3.76,
            192.170.3.77,
            192.170.3.78,
            192.170.3.79,
            192.170.3.80,
            192.170.3.81,
            192.170.3.82,
            192.170.3.83,
            192.170.3.84,
            192.170.3.85,
            192.170.3.86,
            192.170.3.87,
            192.170.3.88,
            192.170.3.89,
            192.170.3.90,
            192.170.3.91,
            192.170.3.92,
            192.170.3.93,
            192.170.3.94,
            192.170.3.95,
            192.170.3.96,
            192.170.3.97,
            192.170.3.98,
            192.170.3.99,
            192.170.3.100,
            192.170.3.101,
            192.170.3.102,
            192.170.3.103,
            192.170.3.104,
            192.170.3.105,
            192.170.3.106,
            192.170.3.107,
            192.170.3.108,
            192.170.3.109,
            192.170.3.110,
            192.170.3.111,
            192.170.3.112,
            192.170.3.113,
            192.170.3.114,
            192.170.3.115,
            192.170.3.116,
            192.170.3.117,
            192.170.3.118,
            192.170.3.119,
            192.170.3.120,
            192.170.3.121,
            192.170.3.122,
            192.170.3.123,
            192.170.3.124,
            192.170.3.125,
            192.170.3.126,
            192.170.3.127,
            192.170.3.128,
            192.170.3.129,
            192.170.3.130,
            192.170.3.131,
            192.170.3.132,
            192.170.3.133,
            192.170.3.134,
            192.170.3.135,
            192.170.3.136,
            192.170.3.137,
            192.170.3.138,
            192.170.3.139,
            192.170.3.140,
            192.170.3.141,
            192.170.3.142,
            192.170.3.143,
            192.170.3.144,
            192.170.3.145,
            192.170.3.146,
            192.170.3.147,
            192.170.3.148,
            192.170.3.149,
            192.170.3.150,
            192.170.3.151,
            192.170.3.152,
            192.170.3.153,
            192.170.3.154,
            192.170.3.155,
            192.170.3.156,
            192.170.3.157,
            192.170.3.158,
            192.170.3.159,
            192.170.3.160,
            192.170.3.161,
            192.170.3.162,
            192.170.3.163,
            192.170.3.164,
            192.170.3.165,
            192.170.3.166,
            192.170.3.167,
            192.170.3.168,
            192.170.3.169,
            192.170.3.170,
            192.170.3.171,
            192.170.3.172,
            192.170.3.173,
            192.170.3.174,
            192.170.3.175,
            192.170.3.176,
            192.170.3.177,
            192.170.3.178,
            192.170.3.179,
            192.170.3.180,
            192.170.3.181,
            192.170.3.182,
            192.170.3.183,
            192.170.3.184,
            192.170.3.185,
            192.170.3.186,
            192.170.3.187,
            192.170.3.188,
            192.170.3.189,
            192.170.3.190,
            192.170.3.191,
            192.170.3.192,
            192.170.3.193,
            192.170.3.194,
            192.170.3.195,
            192.170.3.196,
            192.170.3.197,
            192.170.3.198,
            192.170.3.199,
            192.170.3.200,
            192.170.3.201,
            192.170.3.202,
            192.170.3.203,
            192.170.3.204,
            192.170.3.205,
            192.170.3.206,
            192.170.3.207,
            192.170.3.208,
            192.170.3.209,
            192.170.3.210,
            192.170.3.211,
            192.170.3.212,
            192.170.3.213,
            192.170.3.214,
            192.170.3.215,
            192.170.3.216,
            192.170.3.217,
            192.170.3.218,
            192.170.3.219,
            192.170.3.220,
            192.170.3.221,
            192.170.3.222,
            192.170.3.223,
            192.170.3.224,
            192.170.3.225,
            192.170.3.226,
            192.170.3.227,
            192.170.3.228,
            192.170.3.229,
            192.170.3.230,
            192.170.3.231,
            192.170.3.232,
            192.170.3.233,
            192.170.3.234,
            192.170.3.235,
            192.170.3.236,
            192.170.3.237,
            192.170.3.238,
        }
    }
    chain forward {
        type filter hook forward priority 0;
        iif p2p1 ip saddr @allowed ip protocol tcp accept
        iif p2p1 ip saddr 172.31.1.35 ip protocol tcp accept
        iif p2p2 ip saddr @allowed ip protocol tcp accept
        iif p2p2 ip saddr 172.31.1.27 ip protocol tcp accept
        iif p3p1 ip protocol tcp ct state established|related accept
        iif p3p1 ip protocol tcp drop
    }
}
